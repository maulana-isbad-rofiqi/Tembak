<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Toolkit V8 - Web Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
  <style>
    :root{--primary:#ff4081;--secondary:#4ade80;--dark:#0f0f1b;--card:#16213e;--text:#fff;--sub:#a0a0a0;--accent:#667eea;--error:#ef4444;--success:#22c55e}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:var(--dark);color:var(--text);min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:2rem}
    .container{max-width:900px;width:100%}
    header{text-align:center;margin-bottom:3rem}
    h1{font-size:2.5rem;color:var(--primary);margin-bottom:.5rem}
    .nav{display:flex;gap:1rem;margin-bottom:2rem;flex-wrap:wrap;justify-content:center}
    .nav-btn{padding:.8rem 1.5rem;background:var(--card);border:1px solid var(--accent);border-radius:8px;cursor:pointer;transition:.3s}
    .nav-btn:hover{background:var(--accent);transform:translateY(-2px)}
    .nav-btn.active{background:var(--primary);border-color:var(--primary)}
    .section{background:var(--card);border-radius:16px;padding:2rem;box-shadow:0 10px 30px rgba(0,0,0,.3);margin-bottom:2rem;display:none}
    .section.active{display:block}
    h2{font-size:1.8rem;margin-bottom:1.5rem;color:var(--secondary)}
    .form-group{margin-bottom:1rem}
    label{display:block;margin-bottom:.5rem;color:var(--sub);font-size:.9rem}
    input,select{width:100%;padding:.8rem;background:#0f1424;border:1px solid var(--accent);border-radius:8px;color:var(--text);font-family:'JetBrains Mono',monospace}
    .btn-group{display:flex;gap:1rem;margin-top:1rem}
    button{padding:1rem;flex:1;background:var(--primary);border:none;border-radius:8px;color:#fff;font-weight:600;cursor:pointer;transition:.3s}
    button:hover{background:#e03375;transform:translateY(-2px)}
    button:disabled{background:#666;cursor:not-allowed}
    button.stop{background:#ef4444}
    button.stop:hover{background:#dc2626}
    .log-container{background:#0f1424;border-radius:8px;padding:1rem;max-height:400px;overflow-y:auto;font-family:'JetBrains Mono',monospace;font-size:.85rem;margin-top:1rem}
    .progress-bar{background:#0f1424;height:20px;border-radius:8px;overflow:hidden;margin:1rem 0}
    .progress-fill{background:var(--secondary);height:100%;width:0;transition:width .3s}
    footer{text-align:center;color:var(--sub);font-size:.8rem;margin-top:auto;padding-top:2rem}
    @media(max-width:768px){h1{font-size:2rem}.nav{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Network Toolkit V8</h1>
      <p style="color:var(--sub)">Web Edition – Full Fungsi + Tombol STOP</p>
    </header>

    <div class="nav">
      <button class="nav-btn active" data-section="waster">Buang Paket</button>
      <button class="nav-btn" data-section="stress">Stress Test</button>
      <button class="nav-btn" data-section="speed">Speedtest</button>
    </div>

    <!-- Buang Paket -->
    <section id="waster" class="section active">
      <h2>Buang Paket</h2>
      <div class="form-group">
        <label>Mode Kekuatan</label>
        <select id="waster-workers">
          <option value="10">Slow (10)</option>
          <option value="30" selected>Stabil (30)</option>
          <option value="60">Cepat (60)</option>
          <option value="100">Agresif (100)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Jumlah (kosong = tanpa batas)</label>
        <input type="number" id="waster-size" placeholder="Contoh: 500">
        <select id="waster-unit"><option value="MB">MB</option><option value="GB">GB</option></select>
      </div>
      <div class="btn-group">
        <button id="start-waster">Mulai Buang</button>
        <button id="stop-waster" class="stop" disabled>STOP</button>
      </div>
      <div class="progress-bar"><div id="progress-waster" class="progress-fill"></div></div>
      <div id="log-waster" class="log-container"></div>
    </section>

    <!-- Stress Test -->
    <section id="stress" class="section">
      <h2>HTTP Stress Test</h2>
      <div class="form-group">
        <label>Mode</label>
        <select id="stress-workers">
          <option value="50">Ringan (50)</option>
          <option value="150" selected>Sedang (150)</option>
          <option value="300">Kuat (300)</option>
          <option value="500">Ekstrem (500)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Target URL</label>
        <input type="text" id="stress-url" placeholder="https://example.com">
      </div>
      <div class="form-group">
        <label>Jumlah Request (kosong = tanpa batas)</label>
        <input type="number" id="stress-count" placeholder="10000">
      </div>
      <div class="btn-group">
        <button id="start-stress">Mulai Stress</button>
        <button id="stop-stress" class="stop" disabled>STOP</button>
      </div>
      <div class="progress-bar"><div id="progress-stress" class="progress-fill"></div></div>
      <div id="log-stress" class="log-container"></div>
    </section>

    <!-- Speedtest -->
    <section id="speed" class="section">
      <h2>Speedtest</h2>
      <div class="btn-group">
        <button id="start-speedtest">Jalankan Speedtest</button>
      </div>
      <div id="log-speed" class="log-container"></div>
    </section>

    <footer>&copy; 2025 Network Toolkit V8 – Pure Web, No Error, Ada STOP Button!</footer>
  </div>

  <script>
    const servers = ["https://proof.ovh.net/files/10Mb.dat","http://speedtest.tele2.net/10MB.zip","http://ipv4.download.thinkbroadband.com/10MB.zip"];
    const ua = ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36","Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"];
    let wasterActive = false, stressActive = false;

    function log(id, msg, type='info'){
      const el = document.getElementById(id);
      const div = document.createElement('div');
      div.textContent = `[\( {new Date().toLocaleTimeString()}] \){msg}`;
      div.style.color = type==='success'?'#4ade80':type==='error'?'#ef4444':'#60a5fa';
      el.appendChild(div); el.scrollTop = el.scrollHeight;
    }

    // === BUANG PAKET ===
    document.getElementById('start-waster').onclick = async () => {
      if(wasterActive) return;
      wasterActive = true;
      document.getElementById('stop-waster').disabled = false;
      document.getElementById('start-waster').disabled = true;
      document.getElementById('log-waster').innerHTML = '';
      document.getElementById('progress-waster').style.width = '0%';

      const workers = parseInt(document.getElementById('waster-workers').value);
      let size = parseFloat(document.getElementById('waster-size').value) || Infinity;
      const unit = document.getElementById('waster-unit').value;
      const targetBytes = unit==='GB'? size*1e9 : size*1e6;
      let downloaded = 0;

      log('log-waster', `Mulai buang paket – \( {workers} workers – Target: \){isFinite(targetBytes)? (targetBytes/1e6).toFixed(0)+' MB' : 'Tanpa Batas'}`);

      const worker = async () => {
        while(wasterActive && downloaded < targetBytes){
          const url = servers[Math.floor(Math.random()*servers.length)];
          try{
            const resp = await fetch(url + '?t=' + Date.now(), {cache: 'no-store'});
            const reader = resp.body.getReader();
            while(wasterActive){
              const {done, value} = await reader.read();
              if(done) break;
              downloaded += value.length;
              const percent = isFinite(targetBytes) ? Math.min((downloaded/targetBytes)*100,100) : 0;
              document.getElementById('progress-waster').style.width = percent + '%';
              const speed = (downloaded / ((Date.now()-startTime)/1000) / 1e6).toFixed(2);
              document.getElementById('log-waster').lastChild.textContent = `[\( {new Date().toLocaleTimeString()}] ↓ \){ (downloaded/1e6).toFixed(2) } MB – ${speed} MB/s`;
            }
          }catch(e){}
        }
      };

      const startTime = Date.now();
      const tasks = Array.from({length: workers}, worker);
      await Promise.race([Promise.all(tasks), new Promise(r => setTimeout(()=>r(), 1e9))]);

      if(downloaded >= targetBytes || !wasterActive){
        log('log-waster', 'SELESAI! Total: ' + (downloaded/1e6).toFixed(2) + ' MB', 'success');
        wasterActive = false;
        document.getElementById('stop-waster').disabled = true;
        document.getElementById('start-waster').disabled = false;
      }
    };

    document.getElementById('stop-waster').onclick = () => {
      wasterActive = false;
      log('log-waster', 'Dihentikan oleh user', 'error');
      document.getElementById('stop-waster').disabled = true;
      document.getElementById('start-waster').disabled = false;
    };

    // === STRESS TEST ===
    document.getElementById('start-stress').onclick = async () => {
      if(stressActive) return;
      stressActive = true;
      document.getElementById('stop-stress').disabled = false;
      document.getElementById('start-stress').disabled = true;
      document.getElementById('log-stress').innerHTML = '';
      document.getElementById('progress-stress').style.width = '0%';

      const url = document.getElementById('stress-url').value.trim();
      const workers = parseInt(document.getElementById('stress-workers').value);
      let total = parseInt(document.getElementById('stress-count').value) || Infinity;
      let sent = 0, failed = 0;

      if(!url){ log('log-stress','URL wajib diisi!','error'); stressActive=false; document.getElementById('start-stress').disabled=false; return; }

      log('log-stress', `Menyerang \( {url} – \){workers} workers – ${isFinite(total)?total:'Tanpa Batas'} request`);

      const startTime = Date.now();
      const worker = async () => {
        while(stressActive && sent < total){
          try{
            await fetch(url, {method:'GET', headers:{'User-Agent':ua[Math.floor(Math.random()*ua.length)]}, cache:'no-store'});
            sent++;
          }catch(e){ failed++; }
          const percent = isFinite(total) ? Math.min((sent/total)*100,100) : 0;
          document.getElementById('progress-stress').style.width = percent + '%';
          const rps = (sent / ((Date.now()-startTime)/1000)).toFixed(1);
          document.getElementById('log-stress').lastChild.textContent = `[\( {new Date().toLocaleTimeString()}] Sent: \){sent} | Failed: \( {failed} | RPS: \){rps}`;
        }
      };

      const tasks = Array.from({length: workers}, worker);
      await Promise.race([Promise.all(tasks), new Promise(r => setTimeout(()=>r(), 1e9))]);

      log('log-stress', `SELESAI! Terkirim: \( {sent} | Gagal: \){failed}`, 'success');
      stressActive = false;
      document.getElementById('stop-stress').disabled = true;
      document.getElementById('start-stress').disabled = false;
    };

    document.getElementById('stop-stress').onclick = () => {
      stressActive = false;
      log('log-stress','Dihentikan oleh user','error');
      document.getElementById('stop-stress').disabled = true;
      document.getElementById('start-stress').disabled = false;
    };

    // === SPEEDTEST ===
    document.getElementById('start-speedtest').onclick = async () => {
      const logEl = document.getElementById('log-speed');
      logEl.innerHTML = '';
      log('log-speed','Mengukur ping...');
      const pingStart = Date.now();
      await fetch('https://www.google.com/favicon.ico?' + Date.now());
      const ping = Date.now() - pingStart;
      
      log('log-speed','Mengukur download (10MB)...');
      const dlStart = Date.now();
      await fetch(servers[0] + '?t=' + Date.now()).then(r => r.blob());
      const dlTime = (Date.now() - dlStart) / 1000;
      const download = (10 / dlTime * 8).toFixed(2);

      log('log-speed',`Download: \( {download} Mbps | Ping: \){ping} ms`, 'success');
    };

    // Navigasi
    document.querySelectorAll('.nav-btn').forEach(b => b.addEventListener('click', () => {
      document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(b.dataset.section).classList.add('active');
    }));
  </script>
</body>
</html>
